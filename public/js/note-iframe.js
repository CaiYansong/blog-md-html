var noteContainer=document.getElementById("note-container");function logInfo(t){noteContainer.innerText=noteContainer.innerText+"\nLog: "+t}logInfo("note-iframe init");var targetUrl="https://caiyansong.gitee.io";function postMessageToMain(t){t&&window.parent&&window.parent.postMessage&&window.parent.postMessage(t,targetUrl)}function YuqueRequest({userAgent:t,token:e}){this.userAgent=t||"LP",this.token=e,this.headers={"Content-Type":"application/json","User-Agent":this.userAgent,"X-Auth-Token":this.token}}window.addEventListener("message",function(t){logInfo("message",t.data.type+"---"+t.data.str),t.origin===targetUrl&&(t.data&&"post"===t.data.type?checkAPostYuqueStr(t.data.str,t.data.title||""+Date.now()):t.data&&"get"===t.data.type?getYuque(t.data.slug,function(t){postMessageToMain(t)}):t.data&&"getList"===t.data.type&&getYuqueList(function(t){postMessageToMain(t)}))}),YuqueRequest.prototype.getApi=function(t){return t&&!t.startsWith("/")&&(t="/"+t),"https://caiyansong.com/api/v2/repos/yansong-s4rmt/lp/docs"+(t||"")},YuqueRequest.prototype.request=function(t,e,n,o){var s=new XMLHttpRequest;s.open(e||"post",this.getApi(t)),s.setRequestHeader("Content-Type",this.headers["Content-Type"]),s.setRequestHeader("User-Agent",this.headers["User-Agent"]),s.setRequestHeader("X-Auth-Token",this.headers["X-Auth-Token"]),s.send(JSON.stringify(n)),s.onreadystatechange=function(){4===s.readyState&&o&&o(JSON.parse(s.response))}},YuqueRequest.prototype.get=function(t,e){this.request(t||"/note?row=1","GET",null,function(t){e&&e(t)})},YuqueRequest.prototype.getList=function(t){this.request(null,"GET",null,function(e){t&&t(e)})},YuqueRequest.prototype.post=function(t,e){this.request(null,"POST",Object.assign({title:"Note",slug:"note",public:0,format:"markdown",body:""},t),function(t){e&&e(t)})},YuqueRequest.prototype.put=function(t,e){this.request("/"+e,"PUT",Object.assign({title:"Note",slug:"note",public:0,body:"",_force_asl:1},t),function(t){cb&&cb(t)})};var token="jUrEGFwQzxypup0uDJRK2LyJOQcMeLVktQpCHpWm",defaultId=63815700,request=new YuqueRequest({token:token});function getYuque(t,e){e?request.get(e,function(e){t&&t(e)}):request.getList(function(e){e&&e.length>0?request.get(e[0].slug,function(e){t&&t(e)}):t&&t("")})}function getYuqueList(t){request.getList(function(e){t&&t(e)})}function putYuqueStr(t,e,n,o){request.get(o,function(s){if(s){var u=s.data.body;request.put({body:u+"\n\n"+t,title:e,slug:o||e.toLowerCase().replace(/ /g,"")},n||defaultId,function(t){console.log("put end: ",t)})}})}function postYuqueStr(t,e){request.post({body:t,title:e,slug:e.toLowerCase().replace(/ /g,"")},function(t){console.log("post end: ",t)})}function checkAPostYuqueStr(t,e){getYuqueList(function(n){if(console.log("getList end: ",n),n&&n.data&&n.data.length>0){var o=null,s=n.data;for(let t=0;t<s.length;t++){var u=s[t];u&&u.slug===e.toLowerCase().replace(/ /g,"")&&(o=s[t])}o?putYuqueStr(t,e,o.id,o.slug):postYuqueStr(t,e)}})}